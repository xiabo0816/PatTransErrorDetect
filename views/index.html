<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- <link rel="icon" href="../../favicon.ico"> -->
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <title>Starter Template for Bootstrap</title>

    <!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
    <script src="js/jquery.min.js"></script>
    <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
    <script src="js/bootstrap.min.js"></script>
    <!-- 加载 echarts -->
    <script src="js/echarts.min.js"></script>
    <!-- https://v3.bootcss.com/getting-started/ -->
    <!-- https://echarts.apache.org/examples/zh/editor.html?c=treemap-disk -->

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="css/bootstrap-table.min.css">
    <!-- Latest compiled and minified JavaScript -->
    <script src="js/bootstrap-table.min.js"></script>
    <!-- Latest compiled and minified Locales -->
    <!-- <script src="https://unpkg.com/bootstrap-table@1.18.1/dist/locale/bootstrap-table-zh-CN.min.js"></script> -->
    <style>
        td {
            table-layout: fixed;
            overflow: hidden;
            word-break: break-all;
        }
        
        textarea {
            width: 100%;
            height: 250px;
            background: #f1f1f1;
            border: none;
        }
        
        td:nth-child(1),
        td:nth-child(2) {
            width: 5%;
        }
        
        td:nth-child(3),
        td:nth-child(4) {
            width: 10%;
        }
        
        td:nth-child(5),
        td:nth-child(6) {
            width: 34%;
        }
    </style>
</head>

<body>

    <nav class="navbar navbar-inverse">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
                <a class="navbar-brand" href="#">Project name</a>
            </div>
            <div id="navbar" class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="#">Home</a></li>
                    <li><a href="#about">About</a></li>
                    <li><a href="#contact">Contact</a></li>
                </ul>
            </div>
            <!--/.nav-collapse -->
        </div>
    </nav>

    <div class="container">

        <!-- <div class="starter-template">
            <h1>Bootstrap starter template</h1>
            <p class="lead">Use this document as a way to quickly start any new project.<br> All you get is this text and a mostly barebones HTML document.</p>
        </div> -->

        请选择文本文件:<input type="file" id="file" /><input type="button" value="显示文本文件" onclick="readAsText();" />
        <div name="result" id="result">
            <!--这里显示文件内容-->
        </div>
        <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
        <div id="main" style="width: 100%;height: 600px;"></div>
        <table id="table"></table>
        <script>
            // 基于准备好的dom， 初始化echarts实例
            var myChart = echarts.init(document.getElementById('main'));

            function HTMLEncode(html) {
                var temp = document.createElement("div");
                (temp.textContent != null) ? (temp.textContent = html) : (temp.innerText = html);
                var output = temp.innerHTML;
                temp = null;
                return output;
            }

            $('#table').bootstrapTable({
                // url: 'data1.json',
                pagination: true,
                search: true,
                columns: [{
                    field: 'name',
                    title: 'name'
                }, {
                    field: 'obj',
                    title: 'obj',
                    formatter: function(value, row) {
                        return '<textarea disabled>' + HTMLEncode(value) + '</textarea>'
                    }
                }, {
                    field: 'input_ori_file',
                    title: 'input_ori_file'
                }, {
                    field: 'input_trans_file',
                    title: 'input_trans_file'
                }, {
                    field: 'c_origin',
                    title: 'c_origin',
                    formatter: function(value, row) {
                        return '<textarea disabled>' + HTMLEncode(value) + '</textarea>'
                    }
                }, {
                    field: 'c_trans',
                    title: 'c_trans',
                    formatter: function(value, row) {
                        return '<textarea disabled>' + HTMLEncode(value) + '</textarea>'
                    }
                }]
            })

            function readAsText() {
                var file = document.getElementById("file").files[0];
                var reader = new FileReader();
                reader.readAsText(file);
                myChart.showLoading();
                reader.onload = function(e) {
                    var result = document.getElementById("result");

                    myChart.hideLoading();

                    function colorMappingChange(value) {
                        var levelOption = getLevelOption(value);
                        chart.setOption({
                            series: [{
                                levels: levelOption
                            }]
                        });
                    }

                    var formatUtil = echarts.format;

                    function getLevelOption() {
                        return [{
                            itemStyle: {
                                borderWidth: 0,
                                gapWidth: 5
                            }
                        }, {
                            itemStyle: {
                                gapWidth: 1
                            }
                        }, {
                            colorSaturation: [0.35, 0.5],
                            itemStyle: {
                                gapWidth: 1,
                                borderColorSaturation: 0.6
                            }
                        }];
                    }

                    myChart.setOption(option = {

                        title: {
                            text: 'Disk Usage',
                            left: 'center'
                        },

                        tooltip: {
                            formatter: function(info) {
                                var value = info.value;
                                var treePathInfo = info.treePathInfo;
                                var treePath = [];

                                for (var i = 1; i < treePathInfo.length; i++) {
                                    treePath.push(treePathInfo[i].name);
                                }

                                return [
                                    '<div class="tooltip-title">' + formatUtil.encodeHTML(treePath.join('/')) + '</div>',
                                    '复现: ' + formatUtil.addCommas(value) + ' 次',
                                ].join('');
                            }
                        },

                        series: [{
                            name: 'Disk Usage',
                            type: 'treemap',
                            visibleMin: 300,
                            label: {
                                show: true,
                                formatter: '{b}'
                            },
                            itemStyle: {
                                borderColor: '#fff'
                            },
                            levels: getLevelOption(),
                            data: JSON.parse(this.result).stat
                        }]
                    });

                    $('#table').bootstrapTable('load', JSON.parse(this.result).detail);


                }
            }


            // var uploadedDataURL = 'disk.tree.json';

            myChart.on('click', function(params) {
                // 控制台打印数据的名称
                // console.log(params.data.path);
                if (!params.data.hasOwnProperty('path'))
                    return
                let path_items = params.data.path.split("/")
                switch (path_items.length) {
                    case 3:
                        $('#table').bootstrapTable('filterBy', {
                            name: path_items[1],
                            obj: path_items[2]
                        })
                        break;
                    case 2:
                        $('#table').bootstrapTable('filterBy', {
                            name: path_items[1],
                        })
                        break;

                    default:
                        break;
                }

            });
        </script>
    </div>
    <!-- /.container -->
</body>

</html>